<div class="medea-tpl__layer mda table">
  <div class="table__container" *ngIf="dataSet && dataSet.length">
    <div
      class="table__row header"
      *ngIf="config.showHeader"
      [ngClass]="{clear: (config.headerStyle === 'clear'), clear__bolder: (config.headerStyle === 'clear__bolder')}"
      [ngStyle]="{'grid-template-columns': columnsTemplate}">
      <div class="table__cell selection" *ngIf="config.selection">
        <i
          class="mda-icon mda-fs__15"
          [ngClass]="getSelectionAllIcon()"
          (click)="ev.preventNoNeededEvent($event); selectionAll();"></i>
      </div>
      <div class="table__cell" *ngFor="let head of config.tableData; trackBy: tools.identifier; let i = index;">
        <ng-container *ngIf="!head.noHeadLabel && !head.noOrder">
          <span class="mda-fs__15 order" (click)="orderBy(head.param, i)">{{head.label}}</span>
          <span
            *ngIf="head.showOrderArrow && head.orderDesc"
            (click)="ev.preventNoNeededEvent($event); orderBy(head.param, i);">
            <i class="mda-icon icon-arrow4_up order"></i>
          </span>
          <span
            *ngIf="head.showOrderArrow && !head.orderDesc"
            (click)="ev.preventNoNeededEvent($event); orderBy(head.param, i);">
            <i class="mda-icon icon-arrow4_down order"></i>
          </span>
        </ng-container>
        <span class="mda-fs__15" *ngIf="!head.noHeadLabel && head.noOrder">{{head.label}}</span>
      </div>
      <div class="table__cell dropdown" *ngIf="config.dropdownRow"></div>
    </div>
    <ng-container *ngFor="let row of dataSet; trackBy: tools.identifier; let i = index;">
      <div
        class="table__row"
        [ngStyle]="{'grid-template-columns': columnsTemplate}"
        (mouseenter)="ev.preventNoNeededEvent($event); showSelector($event, i);"
        (mouseleave)="ev.preventNoNeededEvent($event); hideSelectors($event);">
        <div class="table__cell selection" *ngIf="config.selection">
          <i
            class="mda-icon mda-fs__15"
            *ngIf="checkSelection(row) || viewSelector.getValue()[i]"
            [ngClass]="(checkSelection(row)) ? 'icon-square-check selected' : 'icon-checkbox'"
            (click)="selectionAction($event, row)">
          </i>
        </div>
        <div
          class="table__cell"
          [ngClass]="{'radio': cell.type === 'radio', 'select': cell.type === 'select'}"
          *ngFor="let cell of config.tableData; trackBy: tools.identifier; let ordinal = index;">
          <div *ngIf="cell.type && cell.type === 'radio'">
            <i
              class="mda-icon mda-fs__16"
              (click)="ev.preventNoNeededEvent($event); radioAction(row, cell);"
              [ngClass]="(radioColumnsInside && (row[cell.selection] === radioColumnsInside[cell.id])) ?
                'icon-radio-checked selected' :
                'icon-radio'">
            </i>
          </div>
          <ng-container *ngIf="cell.type && cell.type === 'select'">
            <label for="select-{{cell.id}}-{{ordinal}}"></label>
            <div class="mda-select">
              <select
                id="select-{{cell.id}}-{{ordinal}}"
                class="mda-fs__14"
                (change)="ev.preventNoNeededEvent($event); selectColumnAction(row, cell, $event);">
                <option
                  *ngFor="let option of selectColumnsInside[cell.param][row[cell.sourceOptions.selectKeyIdentification]].selectionSource; trackBy: tools.identifier;"
                  [value]="option.key"
                  [selected]="option.key === selectColumnsInside[cell.param][row[cell.sourceOptions.selectKeyIdentification]].selection">
                  {{option.value}}
                </option>
              </select>
            </div>
          </ng-container>
          <div *ngIf="cell.type && cell.type === 'iconAction'">
            <i
              class="mda-icon-button {{cell.iconAction.icon}}"
              [title]="cell.label"
              [ngClass]="(cell.iconAction.iconClass) ? cell.iconAction.iconClass : 'mda-icon'"
              (click)="ev.preventNoNeededEvent($event); doIconAction(cell.iconAction, row)"></i>
          </div>
          <i class="mda-icon mda-fs__16 deco" *ngIf="cell.icon" [ngClass]="cell.icon"></i>
          <span
            class="mda-fs__14"
            [ngClass]="{'color-label': (cell.colorLabel)}"
            [ngStyle]="{
              color: (cell.colorLabel) ? cell.colorLabelMap[row[cell.colorLabelParam]].color : '#333333',
              'background-color': (cell.colorLabel) ? cell.colorLabelMap[row[cell.colorLabelParam]].bkColor : 'transparent'
            }"
            *ngIf="row[cell.param] && !cell.type && !cell.rounded">
            {{getValueFromDotedKey(row, cell)}}
          </span>
          <span
            class="mda-fs__14 help"
            [ngClass]="{'color-label': (cell.colorLabel)}"
            [ngStyle]="{
              color: (cell.colorLabel) ? cell.colorLabelMap[row[cell.colorLabelParam]].color : '#333333',
              'background-color': (cell.colorLabel) ? cell.colorLabelMap[row[cell.colorLabelParam]].bkColor : 'transparent'
            }"
            *ngIf="row[cell.param] && !cell.type && cell.rounded"
            [title]="getValueFromDotedKey(row, cell.param)">
            {{getValueFromDotedKey(row, cell).toFixed(2)}}
          </span>
          <span class="mda-fs__14" *ngIf="!cell.type && !row[cell.param]">-</span>
        </div>
        <div class="table__cell dropdown" *ngIf="config.dropdownRow">
          <i
            class="mda-icon icon-arrow2_down open"
            *ngIf="!row.showDropdown"
            [title]="config.dropdownRow.caption"
            (click)="ev.preventNoNeededEvent($event); showDropdown(i);">
          </i>
          <i
            class="mda-icon icon-arrow2_up close"
            *ngIf="row.showDropdown"
            [title]="config.dropdownRow.caption"
            (click)="ev.preventNoNeededEvent($event); showDropdown(i);">
          </i>
        </div>
      </div>
      <div class="table__row dropdown" *ngIf="config.dropdownRow && row.showDropdown">
        <div class="table__cell">
          <div class="dropdown__row">
            <div class="dropdown__column" *ngFor="let column of getDataToDropdown(row);">
              <div class="content__row" *ngFor="let rowDropdown of column">
                <span class="row__label mda-fs__14">{{formatLabel(rowDropdown.label)}}</span>
                <span class="row__value mda-fs__14">{{row[config.dropdownRow.param][rowDropdown.param]}}</span>
              </div>
            </div>
          </div>
          <div class="dropdown__row controls" *ngIf="restOfDropdownData(row).length">
            <button (click)="showRestOfDropdown(i)" *ngIf="!row.showRestOfDropdown">
              View Other Parameters
            </button>
            <button (click)="showRestOfDropdown(i)" *ngIf="row.showRestOfDropdown">Hide Other Parameters</button>
          </div>
          <div class="dropdown__row" *ngIf="restOfDropdownData(row).length && row.showRestOfDropdown">
            <div class="dropdown__column alone">
              <ng-container *ngFor="let rowOther of restOfDropdownData(row);">
                <div class="content__row">
                  <div class="row__label mda-fs__14">{{formatLabel(rowOther.label)}}</div>
                  <div class="row__value mda-fs__14" *ngIf="!dataType(row[config.dropdownRow.param][rowOther.param])">
                    {{row[config.dropdownRow.param][rowOther.param]}}
                  </div>
                  <div
                    class="row__value complex"
                    *ngIf="dataType(row[config.dropdownRow.param][rowOther.param])">
                    <ng-container *ngIf="!isVoidComplexParam(row[config.dropdownRow.param][rowOther.param])">
                      <span
                        class="mda-fs__14"
                        (click)="showComplexParameter(i, row[config.dropdownRow.param][rowOther.param])">
                        View Content
                      </span>
                        <span
                          *ngIf="!row['show' + row[config.dropdownRow.param][rowOther.param]]"
                          (click)="showComplexParameter(i, row[config.dropdownRow.param][rowOther.param])">
                        <i class="mda-icon icon-arrow4_down"></i>
                      </span>
                        <span
                          *ngIf="row['show' + row[config.dropdownRow.param][rowOther.param]]"
                          (click)="showComplexParameter(i, row[config.dropdownRow.param][rowOther.param])">
                        <i class="mda-icon icon-arrow4_up"></i>
                      </span>
                    </ng-container>
                  </div>
                </div>
                <div
                  class="content__row complex"
                  *ngIf="dataType(row[config.dropdownRow.param][rowOther.param]) &&
                    row['show' + row[config.dropdownRow.param][rowOther.param]] &&
                    !isVoidComplexParam(row[config.dropdownRow.param][rowOther.param])">
                  <div class="row__complex"
                    *ngFor="let complex of getComplexParameterContent(row[config.dropdownRow.param][rowOther.param])">
                    <div class="complex__content" *ngFor="let complexElement of objectKeys(complex)">
                      <span class="complex__label mda-fs__14">{{formatLabel(complexElement)}}:</span>
                      <span class="complex__value mda-fs__14">{{complex[complexElement]}}</span>
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="table__error" *ngIf="dataSet && !dataSet.length && errorMessages">
    <i class="mda-icon icon-alert"></i>
    <div class="error__title mda-fs__22 bold">Session Job Error:</div>
    <div class="error__text mda-fs__18">{{errorMessages}}</div>
  </div>

  <div class="table__loading" *ngIf="!dataSet">
    <cc-spinner *ngIf="dataSet === null" [textMarquee]="textOnNull"></cc-spinner>
    <cc-spinner
      *ngIf="dataSet === undefined"
      [type]="'none'"
      [textMarquee]="textOnUndefined">
    </cc-spinner>
  </div>
</div>
